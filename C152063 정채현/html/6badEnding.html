<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bad Ending</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div id="wrap" class="bewrap">
        <div id="container">
            <div id="content">
                
                <div id="game-area" class="BadEnding"></div>

                <div id="dialogueBox" class="dialogue">
                    <div class="name">플레이어</div>
                    <div class="text" id="dialogueText">...</div>
                    <button id="nextBtn">▼</button>
                    <button id="proceedBtn" style="display: none;">처음부터 다시 시작</button>
                </div>

            </div>
        </div>
    </div>
    <div id="fadeOverlay"></div>

<script>
  // ======== 선언 ========
const dialogues = [
  { name: "외계인", text: "크윽... 실패다...ㅜ" },
  { name: "외계인", text: "눈에 불을켜고 지켜보는 인간들떄문에 아무것도 할 수가 없네" },
  { name: "외계인", text: "일단 우리 행성으로 돌아가 재정비를 하고 돌아오자" }
];

let currentDialogue = 0;
let isTyping = false;
let typingTimer;
let fullText = "";
let charIndex = 0;

const nameBox = document.querySelector('.name');
const textBox = document.querySelector('#dialogueText');
const nextBtn = document.querySelector('#nextBtn');
const dialogueBox = document.querySelector('#dialogueBox');
const fadeOverlay = document.getElementById('fadeOverlay');
const proceedBtn = document.getElementById('proceedBtn');

//======== 기능 ========

function showDialogue() {
  const dialogue = dialogues[currentDialogue];
  fullText = dialogue.text;
  charIndex = 0;
  textBox.textContent = "";
  isTyping = true;

  // 이름 처리
  if (dialogue.name === "") {
    nameBox.style.display = "none";
  } else {
    nameBox.style.display = "block";
    nameBox.textContent = dialogue.name;
  }
  // 마지막 대사
  if (currentDialogue === dialogues.length - 1) {
  isTyping = false;
  textBox.classList.add("impact");
  textBox.textContent = fullText;

  // 버튼 0.5초 뒤에 보여주기
  setTimeout(() => {
    proceedBtn.style.display = 'block';
  }, 1000); // 500ms = 0.5초

  return;
} else {
    textBox.classList.remove("impact");
    proceedBtn.style.display = 'none';
  }
  // 타이핑 시작
  typingTimer = setInterval(() => {
    if (charIndex < fullText.length) {
      textBox.textContent += fullText.charAt(charIndex);
      charIndex++;
    } else {
      clearInterval(typingTimer);
      isTyping = false;
    }
  }, 100); // 속도 조절 가능 (작을수록 빠름)
}

function skipOrAdvance() {
  if (currentDialogue === dialogues.length - 1) {
    return; // 마지막 대사는 키 입력 무시
  }

  if (isTyping) {
    clearInterval(typingTimer);
    textBox.textContent = fullText;
    isTyping = false;
  } else {
    currentDialogue++;
    showDialogue();
  }
}

proceedBtn.addEventListener('click', () => {
  fadeOverlay.classList.add('active');
  setTimeout(() => {
    window.location.href = '2home.html';
  }, 1000);
});

proceedBtn.style.display = 'none'; // 일반 대사에서는 숨김

// 키 입력 처리: 마지막 대사에서는 무시
document.addEventListener('keydown', (e) => {
  if ((e.code === 'Enter' || e.code === 'Space') && currentDialogue < dialogues.length - 1) {
    e.preventDefault();
    skipOrAdvance();
  }
});


hearts = 3
sessionStorage.setItem('hearts', hearts.toString());

window.onload = showDialogue;
</script>

</body>
</html>